function Suggetions(e, t) {
    if (e.length < 2) {
        $("#site-data").remove();
        let minimumSearch = "es" == this.getCurrentLanguage() ? '<div id="ss360-no-results">Lo sentimos, no encontramos resultados para su búsqueda.</div>' : '<div id="ss360-no-results">Sorry, please enter at least two characters.</div>';
        $("#uniqueSearch").append(minimumSearch);
        return;
    }
    (this.query = e), (this.flag = t);
    let s = this;
    clearTimeout(window.watingForNextKeyStrokeForSiteSearch),
        (window.watingForNextKeyStrokeForSiteSearch = setTimeout(function () {
            s.show();
        }, 800));
}


function getUrlParameter() {
    var e = window.location.search.substring(1).split("=");
    var finalString = ""; // Initialize finalString outside the if block

    if (e[0] !== "") {
        var replacedString = e[1].replace(/%20/g, ' ').trim();
        var test = replacedString.replace(/[&\/\\#,+()$~.'":;*%?@!^<>{}]/g, '');
        var finalString = test.trim().replace(/\s+/g, " ");
    }
     
    return "ss360Query" === e[0] && "" !== finalString ? finalString : "";
}

$(document).ready(function () {
    var e = new Suggetions(getUrlParameter(), "search");
    $(document).on("click", ".searchClose", function () {
        $("#site-data").remove();
    }),
        $(document).on("keyup", "#sInput", function (t) {
            var s = e.getCurrentLanguage();
            13 !== t.keyCode ? new Suggetions($(this).val(), "suggest") : "en" !== s ? (window.location = baseUrl + s + "/search.php?ss360Query=" + $(this).val()) : (window.location = baseUrl + "search.php?ss360Query=" + $(this).val());
        }),
        $(document).on("click", ".ss360-suggests a", function (e) {
            e.preventDefault(), window.open($(this).attr("href"), "_blank").focus();
        });
}),
    (Suggetions.prototype = {
        show: function () {
            let e = this;
            this.getResult()
                .then(function (t) {
                    if ("suggest" === e.flag) {
                        var s = $("#sInput").val().trim().toUpperCase();
                        if (t.term.trim().toUpperCase() !== s) {
                            new Suggetions(s, "suggest");
                            return;
                        }
                        e.appendUi(t);
                    } else e.showSearchResult(t);
                })
                .catch(function (e) {
                    console.log("Site search error", e);
                });
        },
        getResult: function () {
            let e = { query: this.query, lang: this.getCurrentLanguage() };
            return (
                "search" === this.flag && (e.full = "1"),
                new Promise(function (t, s) {
                    ajax(apiUrl + "site-search/suggestions", "get", e, null, !0, { requestName: "site-search" }).then(function (e) {
                        $("#counttitle").show(), $("#page_count").html(e.response.count), $("#keyword").html(e.response.term), e.status ? t(e.response) : s(e.response);
                    });
                })
            );
        },
        getCurrentLanguage: function () {
            let e = getUrl().substr(baseUrl.length).split("/").slice(0, 1).join("");
            return -1 === supportedLanguages.indexOf(e) ? supportedLanguages[0] : e;
        },
        appendUi: function (e) {
            var t = $("#sInput").val(),
                s = e.suggestions;
            if (!s.length) {
                $("#site-data").remove();
                return;
            }
            $("#inner-ui").empty(), 0 === $("#site-data").length && $("#site-search").append('<section id="site-data"><ul id="inner-ui"></ul></section>');
            let a = this;
            (s = e.suggestions
                .slice(0, 6)
                .map(function (e) {
                    var s = a.stringTitle(t, e.title);
                    return `<a href="${e.url}" id="link-url"><li id="textTitle">` + s + "</li></a>";
                })
                .join("")),
                $("#inner-ui").append(s);
        },
        stringCase: function (e) {
            return e
                .replace(/\s(.)/g, function (e) {
                    return e.toUpperCase();
                })
                .replace(/^(.)/, function (e) {
                    return e.toLowerCase();
                });
        },
        stringTitle: function (e, t) {
            var s = this.stringCase("abc " + e),
                a = s.length;
            return s.substr(3, a), t.replace(RegExp(`(^${e} )|( ${e} )|( ${e}$)`, "gmi"), "<b>$1$2$3</b>");
        },
        stringContent: function (e, t) {
            console.log(e, t);
            return t ? t.replace(RegExp(`(^${e} )|( ${e} )|( ${e}$)`, "gmi"), "<b>$1$2$3</b>") : null;
        },
        showSearchResult: function (e) {
            let t = this.segregatUrls(e);
            $("#uniqueSearch").append(this.createResultBlock(t.all)),
                $("#blogSearch").append(this.createResultBlock(t.blogs)),
                $("#caseStudySearch").append(this.createResultBlock(t.caseStudies)),
                $("#newsSearch").append(this.createResultBlock(t.news)),
                $("#All").append('<div class="search_itemPageAll"></div>'),
                $("#Blogs").append('<div class="search_itemPageBlog"></div>'),
                $("#News").append('<div class="search_itemPageNews"></div>'),
                $("#caseStudy").append('<div class="search_itemCaseStudy"></div>'),
                this.paginate(),
                this.paginateBlog(),
                this.paginateCase(),
                this.paginateNews();
            let s = "es" == this.getCurrentLanguage() ? '<div id="ss360-no-results">Lo sentimos, no encontramos resultados para su búsqueda.</div>' : '<div id="ss360-no-results">Sorry, we have not found any matches for your query.</div>';
            1 > $("#uniqueSearch").children().size() && ($("#uniqueSearch").append(s), $(".search_itemPageAll").hide()),
                1 > $("#blogSearch").children().size() && ($("#blogSearch").append(s), $(".search_itemPageBlog").hide()),
                1 > $("#newsSearch").children().size() && ($("#newsSearch").append(s), $(".search_itemPageNews").hide()),
                1 > $("#caseStudySearch").children().size() && ($("#caseStudySearch").append(s), $(".search_itemCaseStudy").hide());
        },
        segregatUrls: function (e) {
            let t = this,
                s = { blogs: [], caseStudies: [], news: [], all: [] };
            return (
                $.each(e.suggestions, function (a, n) {
                    switch (((n.content = t.stringContent(e.term, n.content)), !0)) {
                        case -1 !== n.url.indexOf("/blogs/"):
                            s.blogs.push(n);
                            break;
                        case -1 !== n.url.indexOf("/case-study/"):
                            s.caseStudies.push(n);
                            break;
                        case -1 !== n.url.indexOf("/news/"):
                            s.news.push(n);
                            break;
                        default:
                            s.all.push(n);
                    }
                }),
                $.each(s.blogs, function (e, t) {
                    s.all.push(t);
                }),
                $.each(s.caseStudies, function (e, t) {
                    s.all.push(t);
                }),
                $.each(s.news, function (e, t) {
                    s.all.push(t);
                }),
                s
            );
        },
        createResultBlock: function (e) {
            let t = [];
            return (
                $.each(e, function (e, s) {
                    (s = `<li class="ss360-suggests"><article><a href="${s.url}"><header><span role="heading" aria-level="4">${s.title}</span></header></a><a tabindex="-1" href="${s.url}" target="_blank" class="ss360-result-link" aria-hidden="true">${s.url}</a><div class="ss360-content-container"><p>${s.content}</p></div><br><div class="unibox-ca"></div></article></li>`),
                        t.push(s);
                }),
                t.join("")
            );
        },
        paginate: function () {
            var e,
                t,
                s,
                a = $("#All .ss360-suggests"),
                n = a.size(),
                i = n / 10,
                r = 1;
            for (parseInt(i) == i || (parseInt(i) >= parseInt(i) + 0.4 || parseInt(i) <= parseInt(i) + 0.9 ? (i = parseInt(i) + 1) : i >= 0.9 && (totalpages = 1)), e = 0; e <= n; e += 10) {
                for (t = 0; t < 10; t++) $(a[e + t]).addClass("AllPage-" + r);
                r++;
            }
            for (AllpageIndex = 0; AllpageIndex <= i; AllpageIndex++) $(".AllPage-" + AllpageIndex).wrapAll("<div id=Allpage-" + AllpageIndex + ' style="width:100%; display:none;"><div>');
            $(function () {
                $(".search_itemPageAll").pagination({
                    items: n,
                    itemsOnPage: n / 10,
                    pages: i,
                    cssStyle: "light-theme",
                    onPageClick: function () {
                        for (hidepageIndex = 0, s = $(".search_itemPageAll").pagination("getCurrentPage"); hidepageIndex <= i; hidepageIndex++) hidepageIndex != s && $("#Allpage-" + hidepageIndex).hide();
                        $("#Allpage-" + s).show();
                    },
                });
            }),
                $(function () {
                    var e = $(".search_itemPageAll").pagination("getCurrentPage");
                    $("#Allpage-" + e).show();
                });
        },
        paginateBlog: function () {
            var e,
                t,
                s,
                a,
                n,
                i = $("#Blogs .ss360-suggests"),
                r = i.size(),
                l = r / 10,
                o = 1;
            for (parseInt(l) == l || (parseInt(l) >= parseInt(l) + 0.4 || parseInt(l) <= parseInt(l) + 0.9 ? (l = parseInt(l) + 1) : l >= 0.9 && (l = 1)), s = 0; s <= r; s += 10) {
                for (a = 0; a < 10; a++) $(i[s + a]).addClass("blogPage-" + o);
                o++;
            }
            for (t = 0; t <= l; t++) $(".blogPage-" + t).wrapAll("<div id=page-" + t + ' style="width:100%; display:none;"><div>');
            $(function () {
                $(".search_itemPageBlog").pagination({
                    items: r,
                    itemsOnPage: r / 10,
                    pages: l,
                    cssStyle: "light-theme",
                    onPageClick: function () {
                        for (e = 0, n = $(".search_itemPageBlog").pagination("getCurrentPage"); e <= l; e++) e != n && $("#page-" + e).hide();
                        $("#page-" + n).show();
                    },
                });
            }),
                $(function () {
                    var e = $(".search_itemPageBlog").pagination("getCurrentPage");
                    $("#page-" + e).show();
                });
        },
        paginateCase: function () {
            var e,
                t,
                s,
                a = $("#caseStudy .ss360-suggests"),
                n = a.size(),
                i = n / 10,
                r = 1;
            for (parseInt(i) == i || (parseInt(i) >= parseInt(i) + 0.4 || parseInt(i) <= parseInt(i) + 0.9 ? (i = parseInt(i) + 1) : i >= 0.9 && (totalpages = 1)), e = 0; e <= n; e += 10) {
                for (t = 0; t < 10; t++) $(a[e + t]).addClass("caseStudyPage-" + r);
                r++;
            }
            for (caseStudypageIndex = 0; caseStudypageIndex <= i; caseStudypageIndex++) $(".caseStudyPage-" + caseStudypageIndex).wrapAll("<div id=caseStudypage-" + caseStudypageIndex + ' style="width:100%; display:none;"><div>');
            $(function () {
                $(".search_itemCaseStudy").pagination({
                    items: n,
                    itemsOnPage: n / 10,
                    pages: i,
                    cssStyle: "light-theme",
                    onPageClick: function () {
                        for (hidepageIndex = 0, s = $(".search_itemCaseStudy").pagination("getCurrentPage"); hidepageIndex <= i; hidepageIndex++) hidepageIndex != s && $("#caseStudypage-" + hidepageIndex).hide();
                        $("#caseStudypage-" + s).show();
                    },
                });
            }),
                $(function () {
                    var e = $(".search_itemCaseStudy").pagination("getCurrentPage");
                    $("#caseStudypage-" + e).show();
                });
        },
        paginateNews: function () {
            var e,
                t,
                s,
                a = $("#News .ss360-suggests"),
                n = a.size(),
                i = n / 10,
                r = 1;
            for (parseInt(i) == i || (parseInt(i) >= parseInt(i) + 0.4 || parseInt(i) <= parseInt(i) + 0.9 ? (i = parseInt(i) + 1) : i >= 0.9 && (totalpages = 1)), e = 0; e <= n; e += 10) {
                for (t = 0; t < 10; t++) $(a[e + t]).addClass("newsPage-" + r);
                r++;
            }
            for (newspageIndex = 0; newspageIndex <= i; newspageIndex++) $(".newsPage-" + newspageIndex).wrapAll("<div id=newspage-" + newspageIndex + ' style="width:100%; display:none;"><div>');
            $(function () {
                $(".search_itemPageNews").pagination({
                    items: n,
                    itemsOnPage: n / 10,
                    pages: i,
                    cssStyle: "light-theme",
                    onPageClick: function () {
                        for (hidepageIndex = 0, s = $(".search_itemPageNews").pagination("getCurrentPage"); hidepageIndex <= i; hidepageIndex++) hidepageIndex != s && $("#newspage-" + hidepageIndex).hide();
                        $("#newspage-" + s).show();
                    },
                });
            }),
                $(function () {
                    var e = $(".search_itemPageNews").pagination("getCurrentPage");
                    $("#newspage-" + e).show();
                });
        },
    });

function nospaces(evt) {
    if (evt.value.charAt(" ") == 0) {
        evt.value = evt.value.replace(/\s/g, '');
    }
}